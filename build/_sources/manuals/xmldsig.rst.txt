.. _`Описание стандарта подписи`: https://www.w3.org/TR/2013/REC-xmldsig-core1-20130411/ 

Подпись XMLDsig
===============

При работе с документооборотами СФР некоторые отчеты должны быть подписаны подписью в формате xmlDsig. Для этого соответствующий блок Signature выносится по w3c в корень.

Подпись xmlDsig является подписью по правилам СМЭВ 3. `Описание стандарта подписи`_ (см. Enveloped or enveloping signatures).

Если вы испытываете трудности в добавлении подписи в документ черновика на своей стороне, в методах API реализована функция помощи в подписании.


.. _rst-markup-apiForXmlDsig:

Формирование XMLDsig подписи на стороне API 
-------------------------------------------

Порядок вызова методов для формирования подписи XMLDsig:

#. Загрузить в черновик XML-документ отчета. Заявление на подключение к ЭДОК можно сформировать с помощью :doc:`методов формирования файлов documentBuilder</drafts/DraftDocumentBuildController>`.
#. Проверить черновик :ref:`POST Check<rst-markup-check>`.
#. Если в загруженном документе не было XMLDsig, то на шаге Check в документ будет добавлено поле dataToSignContentId.
#. После Check необходимо получить документ :ref:`GET DraftDocument<rst-markup-createdraft>`.
#. Через сервис контентов по dataToSignContentId получить данные для подписи :ref:`GET Download<rst-markup-get-content>`.
#. Подписать эти данные необработанной (raw) подписью.
#. Загрузить в черновик подпись :ref:`POST AddSignature<rst-markup-AddSignature>`.
#. Вызвать для черновика шаг :ref:`POST Prepare<rst-markup-prepare>`. На этом шаге подпись XMLDsig будет добавлена в XML-документ.