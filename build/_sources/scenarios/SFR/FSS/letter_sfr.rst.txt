
.. _rst-markup-letter-sfr:

Письма СФР
==========

Через API Контур.Экстерн можно обмениваться письмами с СФР. Взаимодействие состоит из трех документооборотов:

* широковещательные сообщения СЭДО (тип документооборота urn:docflow:fss-sedo-broadcast-message);
* обращение СФР к страхователю (тип документооборота urn:docflow:fss-sedo-appeal);
* ответ страхователя на обращение СФР (тип документооборота urn:docflow:fss-sedo-appeal-reply).

Широковещательные сообщения СЭДО
--------------------------------

Широковещательные сообщения СЭДО – это общедоступные рассылки от СФР, которые массово отправляют всем работодателям. Такие рассылки не требуют ответа или каких-то действий со стороны работодателя.

**Особенности**

* Документооборот поступает в статусе finished.
* Для получения документов от СФР не нужно выполнять  :doc:`подписку оператора на организацию по РНС</scenarios/SFR/FSS/sedo-subscription>`.
* В метаинформации документооброта возвращается дата, до которой актуально широковещательное сообщение. Параметр ``relevance-date``.

Получение широковещательных сообщений СЭДО
++++++++++++++++++++++++++++++++++++++++++

Найдите входящий документооборот от СФР: :ref:`GET Docflows<rst-markup-get-dcs>`. В запросе укажите фильтр ``type=fss-sedo-broadcast-message``. 

Документооборот Широковещательные сообщения СЭДО поступает в статусе **finished** с готовым документом рассылки. 

Обращение СФР к страхователю
----------------------------

СФР может с помощью писем информировать работодателя или запрашивать дополнительную информацию. Инициатором обмена писем является СФР. Работодатель может отвечать только на входящие письма. 

Если ответ работодателя принят СФР, то повторно прислать ответ на это же письмо нельзя. Если ответ работодателя не принят СФР, то ответ нужно исправить и отправить в СФР повторно.

**Особенности**

* Для получения документов от СФР нужно выполнить :doc:`подписку оператора на организацию по РНС</scenarios/SFR/FSS/sedo-subscription>`.
* Все отправляемые в СЭДО документы являются SOAP-запросами.
* Запросы должны быть подписаны подписью в формате :doc:`XMLDsig</manuals/xmldsig>`.
* Приложения к письму нужно указывать в формате base64 в основном файле ответа, в тегах ``appealFile``. :download:`Пример файла </files/sedo/Пример ответа страхователя на обращение СФР.xml>`.
* Результат приема ответа на письмо нужно смотреть в документе Результат отправки сообщения (urn:document:fss-sedo-appeal-reply-reception-result).

Получение обращения СФР к страхователю
++++++++++++++++++++++++++++++++++++++

Документооборот Обращение СФР к страхователю urn:docflow:fss-sedo-appeal поступает в статусе **received** и не содержит документ с письмом. Для получения документа нужно сформировать запрос на получение документов, подробнее об этом в статье :doc:`Работа с входящими документооборотами</scenarios/SFR/FSS/proactive_ algorithm>`. После получения запроса СФР направит документ с письмом. На поступивший документ нужно отправить :ref:`Отметку о прочтении<rst-markup-reply-docs>`. 

Статусы документооборота и порядок взаимодействия описаны в :ref:`спецификации<rst-markup-fss-sedo-appeal>`.

Отправка ответа страхователя на обращение СФР
+++++++++++++++++++++++++++++++++++++++++++++

Ответ страхователя на образение СФР является отдельным документооборотом urn:docflow:fss-sedo-appeal-reply. Статусы и порядок взаимодействия описаны в :ref:`спецификации<rst-markup-fss-sedo-appeal-reply>`.

Алгоритм работы с методами для создание и отправки ответа на требование смотрите в статье :doc:`Работа с исходящими документооборотами</scenarios/SFR/FSS/proactive_isch>`.

После отправки ответа на обращение поступит результат обработки, тип документа urn:document:fss-sedo-appeal-reply-reception-result. На него необходимо отправить отметку о прочтении, чтобы документооборот перешел в статус **Завершен**. Подробнее об этом читайте в статье Работа с входящими документооборотами, в разделе :ref:`Отметка о прочтении<rst-markup-reply-docs>`.