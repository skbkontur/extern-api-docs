–î–ª—è —Ä–∞–±–æ—Ç—ã —Å API –ö–æ–Ω—Ç—É—Ä.–≠–∫—Å—Ç–µ—Ä–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ —É–∫–∞–∑—ã–≤–∞—Ç—å [auth.sid](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/auth.sid.md) –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å API. –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã —Ä–∞—Å—Å–∫–∞–∂–µ–º –æ —Ç–æ–º, –∫–∞–∫–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å–ø–æ—Å–æ–±—ã –ø–æ–ª—É—á–µ–Ω–∏—è auth.sid. –û—Ç–¥–µ–ª—å–Ω–æ —Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ö–æ–Ω—Ç—É—Ä–∞ –µ–¥–∏–Ω–∞—è, –ø–æ—ç—Ç–æ–º—É –ø–æ–ª—É—á–µ–Ω–∏–µ auth.sid –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω–µ API –ö–æ–Ω—Ç—É—Ä.–≠–∫—Å—Ç–µ—Ä–Ω–∞, –∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º API –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞:
- **–¢–µ—Å—Ç–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞**: https://api.testkontur.ru/auth 
- **–†–∞–±–æ—á–∞—è –ø–ª–æ—â–∞–¥–∫–∞**: https://api.kontur.ru/auth 

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–ø–æ—Å–æ–±–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
* [–ü–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É](#1)
* [–î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–∞—è](#3)

**–ü—Ä–∏–º–µ—Ä—ã**[‚Üí](https://github.com/skbkontur/extern-api-docs/blob/master/examples/–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.md)

<a name="1"></a>
# –ü–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É 

![–°—Ö–µ–º–∞](https://github.com/skbkontur/extern-api-docs/blob/master/images/–ü–æ%20—Å–µ—Ä—Ç—É.jpg)

–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –¥–≤—É—Ö—à–∞–≥–æ–≤–∞—è.
## 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ - —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (*cert*). –°–µ—Ä–≤–µ—Ä –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –µ–≥–æ –∏ –Ω–∞—Ö–æ–¥–∏—Ç –Ω—É–∂–Ω—ã–π userID.
* –î–ª—è userID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - *rnd*. –°–µ—Ä–≤–µ—Ä —à–∏—Ñ—Ä—É–µ—Ç *rnd* (–ø–æ–ª—É—á–∞–µ–º *enc(rnd)*) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

**–ó–∞–ø—Ä–æ—Å**: ```POST /auth/v5.9/authenticate-by-cert?free=value&apiKey=value```, –≥–¥–µ:
* free - –±—É–ª–µ–≤—ã–π —Ñ–ª–∞–≥, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏–ª–∏ –Ω–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (true - –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - false).
* apiKey - [api-key](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/api-key.md).

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞**: —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ PEM-—Ñ–æ—Ä–º–∞—Ç–µ.

**–û—Ç–≤–µ—Ç**:
* EncryptedKey - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ Base-64. –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –µ–µ –∏–∑ Base-64.
* Link - –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
    * Link.Rel - –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏,
    * Link.Href - –∞–¥—Ä–µ—Å —Å—Å—ã–ª–∫–∏.

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤**:
* 200(OK) - –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
* 400(Bad Request) - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
* 403(Forbidden)[‚Üí](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/403%20(Forbidden)%20–æ—Ç%20auth.api.md#2)
* 406(Not Acceptable), –ø—Ä–∏—á–∏–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ:
    * –æ–¥–∏–Ω –∏–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —Ü–µ–ø–æ—á–∫–∏ –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—É—é –ø–æ–¥–ø–∏—Å—å
    * –∏—Å—Ç–µ–∫ –ª–∏–±–æ –Ω–µ –Ω–∞—Å—Ç—É–ø–∏–ª —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
    * —Ü–µ–ø–æ—á–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –Ω–µ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–º –∫–æ—Ä–Ω–µ–≤–æ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ
* 500(InternalServerError)
          
## 2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–æ–ª—É—á–∏–≤ enc(rnd), —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –µ–≥–æ (–ø–æ–ª—É—á–∞–µ–º *dec(enc(rnd))*) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–µ—Ä–≤–µ—Ä—É.
* –ï—Å–ª–∏ dec(enc(rnd)) —Ä–∞–≤–µ–Ω rnd, —Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç *auth.sid*

 **–ó–∞–ø—Ä–æ—Å**: ```POST /auth/v5.9/approve-cert?thumbprint=value&apiKey=value```, –≥–¥–µ:
* thumbprint - –æ—Ç–ø–µ—á–∞—Ç–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.
* apiKey - [api-key](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/api-key.md).

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞**: —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è EncryptedKey –≤ –±–∞–π—Ç–∞—Ö.

**–û—Ç–≤–µ—Ç**:
* Sid - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏ [auth.sid](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/auth.sid.md).
* RefreshToken - –∫–ª—é—á, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏.

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤**:
* 200(OK) - –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
* 400(Bad Request) - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç thumbprint
* 403(Forbidden)[‚Üí](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/403%20(Forbidden)%20–æ—Ç%20auth.api.md#3)
* 500(InternalServerError)

## 3. –ü—Ä–æ–¥–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
–ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ auth.sid –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –µ–≥–æ –æ–±–Ω–æ–≤–∏—Ç—å, —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:
* –ø—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–≤–∞ —à–∞–≥–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É;
* –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∏–∂–µ.

**–ó–∞–ø—Ä–æ—Å**: ```POST /sessions/v5.9/sessions/refresh?auth.sid=value&refresh-token=value&api-key=value```, –≥–¥–µ:
* auth.sid - –æ–±–Ω–æ–≤–ª—è–µ–º–∞—è —Å–µ—Å—Å–∏—è
* refresh-token - —Ç–æ–∫–µ–Ω, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±–Ω–æ–≤–ª—è–µ–º–æ–π —Å–µ—Å—Å–∏–∏
* api-key - [api-key](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/api-key.md).

**–û—Ç–≤–µ—Ç**:
* Sid - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏ [auth.sid](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/auth.sid.md).
* RefreshToken - –∫–ª—é—á, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏.

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤**:
* 200(OK) - –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
* 400(Bad Request) - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç thumbprint
* 403(Forbidden) - –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π api-key –∏–ª–∏ refresh-token 
* 500(InternalServerError)
* 503(ServiceUnavailable) - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –æ—Ç–≤–µ—á–∞—é—Ç

## –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ
* –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É rnd –±—É–¥–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å —Ä–∞–≤–Ω—ã–π userID. 
* rnd –∂–∏–≤–µ—Ç 10 –º–∏–Ω—É—Ç. 
* –£ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–¥–∏–Ω —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π rnd. 
* –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ rnd —É–¥–∞–ª—è–µ—Ç—Å—è.
* enc(rnd) –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ pkcs7
* –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ auth.sid 30 –¥–Ω–µ–π
* –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ refresh-token 45 –¥–Ω–µ–π
* –û—Ç–¥–µ–ª—å–Ω–æ –æ—Ç–º–µ—Ç–∏–º, —á—Ç–æ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (–ø.3) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º location —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏
* –ü–æ—Å–ª–µ –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ (–ø.3) auth.sid –∏ refresh-token —Å—Ç–∞—Ä–æ–π —Å–µ—Å—Å–∏–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏

<a name="3"></a>
# –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–∞—è 
–î–∞–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ö–æ–º–ø–∞–Ω–∏–π-–ü–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –Ω–∞—à–µ–≥–æ –£–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–¥–∞—é—Ç –æ–±–ª–∞—á–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏.  
–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å [auth.sid](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/auth.sid.md), –∏—Å–ø–æ–ª—å–∑—É—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –ö–æ–º–ø–∞–Ω–∏–∏-–ü–∞—Ä—Ç–Ω–µ—Ä–∞. –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏ **–ø–µ—Ä–≤–æ–º** –≤—Ö–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  —Å–∏—Å—Ç–µ–º –ü–∞—Ä—Ç–Ω–µ—Ä–∞ –∏ –ö–æ–Ω—Ç—É—Ä–∞.

## –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–Ω–µ—à–Ω–µ–π –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å–≤—è–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ö–æ–Ω—Ç—É—Ä–∞ —Å–æ —Å–≤–æ–∏–º –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. 

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è auth.sid –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞—É—Ç–Ω–µ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ö–æ–Ω—Ç—É—Ä–∞ –±—ã–ª —Å–≤—è–∑–∞–Ω —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã. –°–≤—è–∑—å –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
* –≤—Ä—É—á–Ω—É—é —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ö–æ–Ω—Ç—É—Ä–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ö–æ–º–ø–∞–Ω–∏–∏-–ü–∞—Ä—Ç–Ω–µ—Ä–∞
* –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å–≤—è–∑—ã–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ö–æ–Ω—Ç—É—Ä–∞ —Å –ª—é–±—ã–º —Å–≤–æ–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ [api-key](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/api-key.md) –ö–æ–º–ø–∞–Ω–∏–∏-–ü–∞—Ä—Ç–Ω–µ—Ä–∞.

**–ó–∞–ø—Ä–æ—Å**: ```PUT /auth/v5.9/register-external-service-id?api-key=value&serviceUserId=value&phone=value```, –≥–¥–µ:
* phone - –æ–±—ä–µ–∫—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
* serviceUserId - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
* api-key - [api-key](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/api-key.md)
 
**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤**:
* 200(OK) - –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
* 400(Bad Request) - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
* 401(Unauthorized) - api-key –Ω–µ —É–∫–∞–∑–∞–Ω 
* 403(Forbidden)[‚Üí](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/403%20(Forbidden)%20–æ—Ç%20auth.api.md)
* 500(InternalServerError)

## –ú–µ—Ç–æ–¥ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
![–°—Ö–µ–º–∞](https://github.com/skbkontur/extern-api-docs/blob/master/images/–î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–∞—è.jpg)

–î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–≤—É—Ö—à–∞–≥–æ–≤–∞—è.

## 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
* –¥–æ–≤–µ—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (–∫–ª–∏–µ–Ω—Ç) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–≤–æ–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (*serviceUserId*)
* –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞ —Å–≤–æ–∏–º –∫–ª—é—á–æ–º (–æ—Ç–∫—Ä—ã—Ç—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–∞–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –ö–æ–Ω—Ç—É—Ä, –æ–Ω –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –Ω–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ), –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ [RSA](https://ru.wikipedia.org/wiki/RSA), —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –∫–ª—é—á –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤ –û–° Windows[‚Üí](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/RSA%20certs.md), –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OpenSSL[‚Üí](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/using%20OpenSSL%20+%20RSA.md)
* —Å–µ—Ä–≤–µ—Ä —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á (*rnd*) –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –µ–≥–æ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ

**–ó–∞–ø—Ä–æ—Å**: ```POST /auth/v5.9/authenticate-by-truster?apiKey=value&credential=value&timestamp=value&serviceUserId=value ```, –≥–¥–µ:
* serviceUserId - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–º —Å–∏—Å—Ç–µ–º–µ.
* apiKey - [api-key](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/api-key.md).
* credential  - –æ–±—ä–µ–∫—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è:
    * thumbprint - –æ—Ç–ø–µ—á–∞—Ç–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    * phone - 10-–∑–Ω–∞—á–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    * snils - 11-–∑–Ω–∞—á–Ω—ã–π –°–ù–ò–õ–° –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
* timestamp -  –º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞**: –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å, –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –≤–∏–¥–µ –º–∞—Å—Å–∏–≤–∞ –±–∞–π—Ç–æ–≤ –±–µ–∑ –≤—Å—è–∫–æ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ (–∫–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-8): ```string.Format("apikey={0}\r\nid={1}\r\ntimestamp={2}\r\n", ApiKey.ToLower(), Id, Timestamp)```, –≥–¥–µ:
* apiKey -  [api-key](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/api-key.md) –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ,
* id - –æ–±—ä–µ–∫—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä credential –∏–∑ query-string –∑–∞–ø—Ä–æ—Å–∞,
* timestamp -  –º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ (–≤ —Ñ–æ—Ä–º–∞—Ç–µ "dd.MM.yyyy HH:üá≤üá≤:ss", –≤—Ä–µ–º—è GMT)

–ü–æ–¥–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ PKCS#7: –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è hash-—Ñ—É–Ω–∫—Ü–∏–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É, –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏ —Å—Ç—Ä–æ–∫–∏, –ø–æ—Å–ª–µ —á–µ–≥–æ –æ–Ω –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å PKCS#7.

**–û—Ç–≤–µ—Ç**:
* Key - —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞.
* Link - –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
    * Link.Rel - –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏,
    * Link.Href - –∞–¥—Ä–µ—Å —Å—Å—ã–ª–∫–∏.
    
**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤**:
* 200(OK) - –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
* 400(Bad Request) 
* 401(Unauthorized) - api-key –Ω–µ —É–∫–∞–∑–∞–Ω 
* 403(Forbidden)[‚Üí](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/403%20(Forbidden)%20–æ—Ç%20auth.api.md)
* 500(InternalServerError)

## 2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
* –î–æ–≤–µ—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –ø–æ–ª—É—á–∏–≤ —Å–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ *rnd* –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å, –≥–¥–µ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç *rnd*.
* –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ—Ç –ª–∏ —ç—Ç–æ—Ç *rnd*, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–ª —Ä–∞–Ω–µ–µ, –≤ —Å–ª—É—á–∞–µ —É—Å–ø–µ—Ö–∞ –æ—Ç–¥–∞–µ—Ç auth.sid.

**–ó–∞–ø—Ä–æ—Å**: ```POST /auth/v5.9/approve-truster?key=value&id=value&apiKey=value ```, –≥–¥–µ:
* key - —Å–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ *rnd*.
* apiKey - [api-key](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/api-key.md).
* id - –æ–±—ä–µ–∫—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä credential –∏–∑ query-string –∑–∞–ø—Ä–æ—Å–∞ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–û—Ç–≤–µ—Ç**:
* Sid - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏ [auth.sid](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/auth.sid.md).

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤**:
* 200(OK) - –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
* 400(Bad Request) - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
* 401(Unauthorized) - api-key –Ω–µ —É–∫–∞–∑–∞–Ω 
* 403(Forbidden)[‚Üí](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/403%20(Forbidden)%20–æ—Ç%20auth.api.md)
* 500(InternalServerError)
