.. _`разделе Сверка по НДС`: https://developer.kontur.ru/doc/extern.nds 
.. _`GET NdsOrganizations`: https://developer.kontur.ru/doc/extern.nds/method?type=get&path=%2Fnds%2Fv1%2Forganizations 
.. _`GET NdsOrganization`: https://developer.kontur.ru/doc/extern.nds/method?type=get&path=%2Fnds%2Fv1%2Forganizations%2F%7BorganizationId%7D
.. _`GET NdsDeclarations`: https://developer.kontur.ru/doc/extern.nds/method?type=get&path=%2Fnds%2Fv1%2Forganizations%2F%7BorganizationId%7D%2Fdeclarations
.. _`GET NdsDeclaration`: https://developer.kontur.ru/doc/extern.nds/method?type=get&path=%2Fnds%2Fv1%2Forganizations%2F%7BorganizationId%7D%2Fdeclarations%2F%7BdeclarationId%7D
.. _`GET NdsContractors`: https://developer.kontur.ru/doc/extern.nds/method?type=get&path=%2Fnds%2Fv1%2Forganizations%2F%7BorganizationId%7D%2Fcontractors
.. _`GET NdsContractor`: https://developer.kontur.ru/doc/extern.nds/method?type=get&path=%2Fnds%2Fv1%2Forganizations%2F%7BorganizationId%7D%2Fcontractors%2F%7BcontractorId%7D
.. _`GET NdsSummaries`: https://developer.kontur.ru/doc/extern.nds/method?type=get&path=%2Fnds%2Fv1%2Forganizations%2F%7BorganizationId%7D%2Fcontractors%2F%7BcontractorId%7D%2Fsummaries


Методы Сверки по НДС
====================

В данном разделе описаны методы для получения статистики по счетам-фактурам организаций, которые добавлены в учетную запись сервиса НДС+, и их контрагентов. 

Подробная спецификация методов показана в Swagger в `разделе Сверка по НДС`_. 

.. contents:: Список доступных методов:
   :depth: 2

.. warning::  В параметрах методов используется ``organizationId`` – идентификатор организации. Он относится к организациям, которые добавлены в учетную запись сервиса НДС+. 

.. _rst-markup-ndsorgs:

Поиск организаций
-----------------

Метод: `GET NdsOrganizations`_

Метод вернет список организаций, для которых доступна статистика по декларациям. 

**Параметры запроса**

``belongingType`` – признак принадлежности организации. При запросе организации можно отфильтровать по признаку:

* ``my`` – значение по умолчанию, будут найдены все организации, которые добавлены в учетную запись сервиса НДС+;
* ``contractorWithPermission`` – будут найдены все контрагенты, которые дали разрешение на просмотр данных деклараций по НДС.

.. note:: В ответах методов API могут встретиться еще два признака принадлежности:
    
    * ``contractor`` – контрагенты, которые встречаются в декларациях организации, но не дали разрешение на просмотр своих данных;
    * ``subcontractor`` – контрагенты, которые встречаются в декларациях контрагентов организации.
    
    Отображение организаций с этими признаками принадлежности еще в разработке.
    
    При вызове метода организации нельзя отфильтровать по признакам принадлежности ``contractor`` и ``subcontractor``.

.. _rst-markup-ndsorg:

Получение организации по идентификатору
---------------------------------------

Метод: `GET NdsOrganization`_ 

Метод вернет по идентификатору ``organizationId`` информацию об организации: ИНН, КПП, наименовании организации, признак принадлежности.

.. _rst-markup-ndsdecs:

Получение списка деклараций
---------------------------

Метод: `GET NdsDeclarations`_

Метод вернет список деклараций по идентификатору организации ``organizationId`` . В поле ``summary`` будет представлено количество счетов-фактур по каждому разделу декларации как общее, так и с расхождениями и разрывами.  

**Параметры запроса** 

``year`` – фильтр по году подачи декларации. В данном параметре нужно передать год, в рамках которого необходимо получить список деклараций. Можно указать любой год с 2015, при условии что организации работали в сервисе НДС+ с этого периода. Год нужно указать в формате "yyyy". 

``quarter`` – фильтр по кварталу подачи декларации. В данном параметре нужно передать квартал, в рамках которого необходимо получить список деклараций. Квартал можно указать одной цифрой, допустимые значения: 1, 2, 3, 4. Если при запросе не будет указан квартал, то вернуться декларации за все кварталы указанного года в параметре year.

Если при запросе не будут указаны год и квартал, то вернеться список деклараций за все доступные периоды.

.. _rst-markup-ndsdec:

Получение декларации
--------------------

Метод: `GET NdsDeclaration`_

Метод вернет показатели декларации по ее идентификатору ``declarationId``. Ответ метода содержит количество счетов-фактур по каждому разделу декларации как общее, так и с расхождениями и разрывами.  

.. _rst-markup-ndscontrs:

Получение списка контрагентов
-----------------------------

Метод: `GET NdsContractors`_

Метод вернет всех контрагентов организации по ее идентификатору ``organizationId``. Список формируется по данным деклараций за период: году и кварталу подачи декларации. 

В ответе метода в поле ``ContractorSummary`` для каждого контрагента будут указаны суммы НДС и количество счетов-фактур в декларации по разделам, а также сумма НДС и количество счетов-фактур с расхождениями и разрывами. 

**Параметры запроса**

``orderBy`` – фильтр по показателям декларации. Список контрагентов можно отсортировать по показателям:

* ``invoicesTotal`` – количество счетов-фактур;
* ``invoicesDifferent`` – количество счетов-фактур с разрывами и расхождениями;
* ``ndsSumTotal`` – суммы НДС;
* ``ndsSumDifferent`` – суммы НДС при расхождениях и разрывах. 

``year`` – фильтр по году подачи декларации. В данном параметре нужно передать год, в рамках которого необходимо получить список контрагентов. Можно указать год с 2015, при условии что организации работали в сервисе НДС+ с этого периода. Год нужно указать в формате "yyyy". 

``quarter`` – фильтр по кварталу подачи декларации. В данном параметре нужно передать квартал, в рамках которого необходимо получить список контрагентов. Квартал можно указать одной цифрой, допустимые значения: 1, 2, 3, 4. 

Если при запросе не будут указаны год и квартал, то будет возвращен список контрагентов за все периоды. 

**Возможные коды ответов:**

* 400 BadRequest – указаны некорректные выходные данные или в запросе передан= год без квартала или квартал без года.

.. _rst-markup-ndscontr:

Получение контрагента по идентификатору
---------------------------------------

Метод: `GET NdsContractor`_

Метод вернет результаты сверки с контрагентом за все периоды по идентификатору организации ``organizationId`` и идентификатору контрагента contractorId. 

В ответе метода в поле ``summary`` по каждому разделу декларации будут указаны суммы НДС и количество счетов-фактур, а также сумма НДС и количество счетов-фактур с расхождениями и разрывами. 

.. _rst-markup-ndssum:

Суммарные показатели контрагента
--------------------------------

Метод: `GET NdsSummaries`_

Метод вернет показатели деклараций в разрезе одного контрагента по его идентификатору ``contractorId``. 

**Параметры запроса**

``year`` – фильтр по году подачи декларации. В данном параметре нужно передать год, в рамках которого необходимо получить показатели. Можно указать год с 2015, при условии что организации работали в сервисе НДС+ с этого периода. Год нужно указать в формате "yyyy".

``quarter`` – фильтр по кварталу подачи декларации. В данном параметре нужно передать квартал, в рамках которого необходимо получить показатели. Квартал можно указать одной цифрой, допустимые значения: 1, 2, 3, 4. Если при запросе не будет указан квартал, то будут возвращены декларации за все кварталы указанного года в параметре year.

Если при запросе не будут указаны год и квартал, то будут возвращены показатели за все периоды.

