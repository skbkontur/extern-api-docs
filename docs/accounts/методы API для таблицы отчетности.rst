.. _Accounts: https://developer.kontur.ru/doc/extern/method?type=get&path=%2Fv1
.. _`GET Forms`: https://developer.kontur.ru/doc/extern/method?type=get&path=%2Fv1%2F%7BaccountId%7D%2Freports-tables%2F%7BorgId%7D%2Fforms
.. _`POST FormsSearch`: https://developer.kontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Freports-tables%2Fsearch
.. _`GET ReportDocflow`: https://developer.kontur.ru/doc/extern/method?type=get&path=%2Fv1%2F%7BaccountId%7D%2Freports-tables%2F%7BorgId%7D%2Freport-docflows 
.. _`POST SearchPayments`: https://developer.kontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Freports-tables%2Fsearch-payments

Методы для работы с таблицей отчетности
=======================================

Подробная спецификация методов представлена в swagger в разделе Accounts_.

Список доступных методов:

* `Получение списка форм отчетности для организации`_
* `Поиск форм отчетности с дедлайнами по нескольким организациям`_
* `Детализация по форме отчетности`_
* `Получение списка платежных поручений по организациям`_

.. _rst-markup-forms:

Получение списка форм отчетности для организации
------------------------------------------------

Метод: `GET Forms`_

Метод позволяет получить список форм отчетности организации. Для каждой формы также вернется краткая информация: наименование, КНД и периодичность сдачи формы.

**Параметры запроса**

``includeDeleted`` – флаг отображения скрытых форм отчетности. Если передано значение *true*, то можно получить формы отчетности, которые были скрыты в веб-интерфейсе Контур.Экстерна. Значение по умолчанию *false*.

.. _rst-markup-formssearch:

Поиск форм отчетности с дедлайнами по нескольким организациям
-------------------------------------------------------------

Метод: `POST FormsSearch`_

С помощью метода можно получить список форм отчетности с крайними сроками подачи в контролирующие органы, дедлайнами по переданным идентификаторам организаций ``organization-ids``. По умолчанию вернутся все формы за предыдущие три месяца и следующие три месяца от текущей даты.

**Параметры запроса**

* ``organization-ids`` – идентификаторы организаций. Можно указать идентификатор одной организации или же нескольких; 
* ``includeDeleted`` – флаг отображения скрытых форм отчетности. Если передано значение *true*, то можно получить формы отчетности, которые были скрыты в веб-интерфейсе Контур.Экстерна. Значение по умолчанию *false*;
* ``date-from`` – начало периода, за который нужно получить формы отчетности;
* ``date-to`` – конец периода, за который нужно получить формы отчетности. 

.. note:: При работе с периодом можно не указывать один из параметров — начало или конец. Тогда будет подставлено значение по умолчанию. Например:

            * если не указано начало периода и указан конец, то метод вернет все формы отчетности за последние три месяца от текущей даты до указанного конца периода; 
            * если не указан конец периода, то метод вернет все формы отчетности от указанного начала периода и за три следующих месяца от текущей даты. 

В ответ на запрос метод вернет актуальную информацию о статусе формы отчета:

* ``declined`` — отчёт отклонён;
* ``notSentAfterDeadline`` — дедлайн прошёл, отчёт не отправлен;
* ``sentAfterDeadline`` — отправлен после дедлайна;
* ``acceptedWithWarning`` — на корректировку пришёл отказ;
* ``notSent`` — не отправлен;
* ``sent`` — отправлен;
* ``acceptedAfterDeadline`` — принято после дедлайна;
* ``acceptedWithSent`` — отчёт принят, был отправлен новый;
* ``acceptedCustom`` — отмечен вручную как сданный;
* ``accepted`` — отчёт принят в срок;
* ``acceptedWithRebuke`` — на отчет пришло уведомление об уточнении;
* ``notRequiredReport`` — не нужно сдавать отчёт, отмечен вручную. 


.. _rst-markup-reportdocflow:

Детализация по форме отчетности
-------------------------------

Метод: `GET ReportDocflow`_

Метод вернет сведения по форме отчетности для указанной организации. Для отправленных отчетов вернется список документооборотов с краткой информацией по каждому и актуальным статусом. Для неотправленного отчета вернется пустой список.

В ответ на запрос метод вернет текущий статус документооборота:

* ``error`` — статус не был заполнен, произошел сбой;
* ``declined`` — документооборот отклонен;
* ``sent`` — документооборот отправлен;
* ``accepted`` — документооборот принят в срок;
* ``editing`` – статус вернется для отчетов РПН до 2018 года;
* ``acceptedWithRebuke`` — требуется корректировка.


.. _rst-markup-searchpayments:

Получение списка платежных поручений по организациям
----------------------------------------------------

Метод: `POST SearchPayments`_

Метод вернет список платежных поручений по переданным идентификаторам организаций ``organization-ids``.

По каждому платежному поручению вернутся актуальные сведения и информация о внесенных платежах:

* ``payment`` – сведения о платежных поручениях организации; 
* ``full-name`` – наименование платежного поручения;
* ``short-name`` – короткое наименование платежного поручения;
* ``payment-form-id`` – идентификатор платежного поручения. Если платежное поручение по форме отчетности, то идентификатор будет такой же, как у формы;
* ``periodicity`` – периодичность оплаты платежного поручения:

    * ``yearly`` – ежегодный;
    * ``quarterly`` – ежеквартальный;
    * ``monthly`` – ежемесячный.

* ``payment-periods`` — сведения о внесенных платежах:
    
    * ``deadline`` — конечный срок оплаты платежа в конкретном периоде;
    * ``period-year`` — год периода платежа;
    * ``period-type`` — периодичность платежа, относительно которого определяется ``PeriodNumber``:

        * ``yearly`` – ежегодный,
        * ``quarterly`` – ежеквартальный,
        * ``monthly`` – ежемесячный;

    * ``period-number`` — порядковый номер периода, в котором происходит платеж;
    * ``payment-number-in-period`` — порядковый номер платежа внутри текущего периода. Для случаев, когда за один период происходит несколько платежей.

В зависимости от периодичности платежа ``period-type`` могут быть разные значения порядкового номера периода ``period-number`` и порядкового номера платежа внутри периода ``payment-number-in-period``.

Например:

* если при ежегодной периодичности оплаты платежного поручения ``periodicity`` = ``yearly``, периодичность платежа ежегодная ``period-type`` = ``yearly``, то за год был внесен один платеж. Тогда порядковый номер периода платежа будет равен 1: ``period-number`` = ``1``. Платежу не будет присвоен порядковый номер внутри периода ``payment-number-in-period``.

* если при ежеквартальной периодичности оплаты платежного поручения ``periodicity`` = ``quarterly``, периодичность платежа ежемесячная ``period-type`` = ``monthly``, то за квартал было внесено три платежа. Тогда порядковый номер периода платежа ``period-number`` будет равен календарной цифре месяца. К примеру, платежное поручение по НДС за 4 квартал 2022 года было оплачено тремя платежами: один за октябрь, второй за ноябрь и третий за декабрь. Тогда номера периодов будут равны 10, 11 и 12 соответственно. Каждый платеж в периоде будет иметь свой порядковый номер ``payment-number-in-period``: за октябрь - 1, за ноябрь - 2 и за декабрь - 3.

**Пример ответа** 

.. code-block:: json
    
    {
    "skip": 0,
    "take": 1,
    "total-count": 1,
    "organization-payments": [
        {
        "organization-id": "00000000-0000-0000-0000-000000000000",
        "payments": [
            {
            "full-name": "Налог на добавленную стоимость на товары (работы, услуги), реализуемые на территории РФ",
            "short-name": "НДС",
            "payment-form-id": 101000,
            "periodicity": "monthly",
            "payment-periods": [
                {
                "deadline": "2023-01-30T00:00:00.0000000",
                "period-year": 2022,
                "period-type": "quarterly",
                "period-number": 4,
                "payment-number-in-period": 1
                },
                {
                "deadline": "2023-02-28T00:00:00.0000000",
                "period-year": 2022,
                "period-type": "quarterly",
                "period-number": 4,
                "payment-number-in-period": 2
                },
                {
                "deadline": "2023-03-28T00:00:00.0000000",
                "period-year": 2022,
                "period-type": "quarterly",
                "period-number": 4,
                "payment-number-in-period": 3
                }
            ]
        }
    ]
    }

