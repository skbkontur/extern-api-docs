.. _`27.10.2010 № 370`: https://normativ.kontur.ru/document?moduleId=1&documentId=415625
.. _`сайте Росстат`: https://support.kontur.ru/extern/39149-formy_otchetnosti_i_sroki_sdachi#header_39149_1
.. _`кода ОКПО`: https://www.b-kontur.ru/profi/okpo-po-inn-ili-ogrn
.. _`исходящий документооборот с Росстат`: https://developer.kontur.ru/doc/extern.test.tools/method?type=post&path=%2Ftest-tools%2Fv1%2Fgenerate-stat-report


Отчетность в Росстат
====================

С помощью API Контур.Экстерна можно передавать отчетность в Росстат. Электронный документооборот с Росстат утвержден Приказом Росстата от `27.10.2010 № 370`_. Формы и сроки подачи отчетности можно определить на `сайте Росстат`_. 

Со своей стороны мы проверим файлы отчета на наличие ошибок перед отправкой их в территориальный орган Росстата (ТОГС). Для этого потребуется файл отчета и электронная подпись, которая используется для подписания. 

**Особенности**

* Для отправки отчета в Росстат обязательно указание `кода ОКПО`_ — это реквизит организации, который присваивает орган государственной статистики при регистрации.
* Для уполномоченных представителей в рамках документооборота с ТОГС не предусмотрена отправка доверенности, поэтому дополнительно прикладывать файл Сообщения о представительстве не нужно.
* В спецификации есть актуальная информация по :ref:`статусам документооборотов<rst-markup-stat-reports-status-do>` и по :ref:`типам документов<rst-markup-stat-report-type-document>`. 
* Ответные документы на отправленный отчет поступят в течение 3 рабочих дней с момента поступления в ТОГС.

Алгоритм работы с методами API Контур.Экстерна
----------------------------------------------

1. Создайте черновик: :ref:`POST Create draft<rst-markup-createdraft>`. При создании черновика в теле запроса обязательно укажите:

    * ``sender``: ``togs-code`` — код ТОГС;
    * ``recipient``: ``okpo`` — код ОКПО;
    * ``additional-info``: ``machine-readable-warrant-id`` — идентификатор машиночитаемой доверенности, если сдаете отчетность через уполномоченного представителя.

2. Загрузите файл отчета в :ref:`Сервис контентов<rst-markup-load>`. В ответ метод загрузки вернет идентификатор загруженного контента ``content-id``.
3. Создайте документ: :ref:`POST Add Document<rst-markup-addDocument>`. Укажите идентификатор контента в параметре ``content-id``.
4. Приложите подпись к каждому документу: :ref:`POST Add signature<rst-markup-AddSignature>`.
5. Когда черновик готов, запустите последовательность методов: :ref:`POST Check<rst-markup-check>` -> :ref:`POST Prepare<rst-markup-prepare>` -> :ref:`POST Send<rst-markup-send>`. Укажите флаг ``deferred = true`` для отложенного выполнения задач.
6. Проверьте статус выполнения задач для методов ``Check``, ``Prepare``, ``Send``: :ref:`GET DraftTask<rst-markup-DraftTasks>`. Если задача по методу ``Send`` завершилась успешно, то в ответе вернется информация о созданном документообороте.

Далее нужно отлеживать статус документооборота: :ref:`GET Docflows<rst-markup-get-dcs>`.

Тестовые данные
---------------

С помощью сервиса тестовых данных можно сгенерировать `исходящий документооборот с Росстат`_.

Для тестовых запросов можете воспользоваться :ref:`примерами файлами<rst_markup_stat_example_files>` для Росстат. В примерах необходимо указать свои данные организации, подписанта и код ОКПО. 