Работа с исходящими документооборотами
======================================

В схеме проактивных выплат работодатель направляет в СФР следующие исходящие документообороты:
    
    * urn:docflow:fss-sedo-insured-person-registration – сведения о застрахованных лицах;
    * urn:docflow:fss-sedo-proactive-payments-reply – ответ на запрос проверки, подтверждения, корректировки сведений проактивной выплаты страхового обеспечения;
    * urn:docflow:fss-sedo-benefit-payment-initiation – инициация выплат пособия;
    * urn:docflow:fss-warrant-management – запрос на регистрацию и отзыв доверенности СФР;
    * urn:docflow:fss-sedo-demand-reply – ответ на требование СФР;
    * urn:docflow:fss-sedo-billing-information-demand – запрос на формирование справки о расчетах СФР;
    * urn:docflow:fss-sedo-baby-care-vacation-close-notice – уведомление о прекращении отпуска по уходу за ребенком до полутора лет;
    * urn:docflow:fss-sedo-appeal-reply – ответ страхователя на обращение СФР;
    * urn:docflow:fss-sedo-disability-children-demand – заявление о возмещении расходов на оплату дополнительных выходных дней для ухода за детьми-инвалидами;
    * urn:docflow:fss-sedo-additional-vacation-statement – сведения для оплаты отпуска застрахованного лица;
    * urn:docflow:fss-sedo-additional-vacation-statement-docs – направление дополнительных документов по сведениям для оплаты отпуска застрахованного лица.


Далее для каждого документооборота создайте черновик и отправьте его. 

**Особенности документооборотов СФР**

* Для получения документов от СФР нужно выполнить :doc:`подписку оператора на организацию по РНС</scenarios/SFR/FSS/sedo-subscription>`.
* Все отправляемые в СЭДО документы являются SOAP-запросами.
* Запросы должны быть подписаны подписью в формате :doc:`XMLDsig</manuals/xmldsig>`.
* Результат приема отчета "Сведения о застрахованном лице" нужно смотреть в документе "Результат регистрации сведений о застрахованных лицах" (urn:document:fss-sedo-insured-person-registration-result-response-result) по каждому СНИЛС отдельно.

Создание и отправка черновика
-----------------------------

.. warning:: С 1 ноября 2024 года СФР не принимает отчетность с регистрационным номером ФСС. Отчетность необходимо подавать с единым регистрационным номером (ЕРН). 
    
    В API Контур.Экстерна укажите ЕРН в поле ``registration-number-sfr``.



1. Создайте черновик: :ref:`POST Create draft<rst-markup-createdraft>`. При создании черновика в теле запроса обязательно укажите:
    
    a. в ``payer`` параметр ``registration-number-sfr``;
    b. в ``recipient`` параметр ``fss-code``;
    c. в ``additional-info`` параметр ``machine-readable-warrant-id`` – укажите идентификатор машиночиамой доверенности, если отправляете отчет через уполномоченного представителя.

2. Загрузите файл документа в :ref:`Сервис контентов<rst-markup-load>`.
3. Создайте документ в черновике: :ref:`POST Add Document<rst-markup-addDocument>`. При создании укажите ссылку на документ в виде идентификатора из :ref:`Сервиса контентов<rst-markup-load>`.
4. Возьмите идентификатор контента для подписания из метаинформации ответа метода ``Add Document`` в поле ``data-to-sign-content-id`` и получите данные через :ref:`Сервис контентов<rst-markup-dowload>`. 
5. Подпишите эти данные необработанной (raw) подписью. 
6. Приложите подпись к документу: :ref:`POST Add signature<rst-markup-AddSignature>`.
7. Когда черновик готов, запустите последовательность методов: :ref:`POST Check<rst-markup-check>` -> :ref:`POST Prepare<rst-markup-prepare>` -> :ref:`POST Send<rst-markup-send>`. Укажите флаг ``deferred = true`` для отложенного выполнения задач. 
8. Проверьте статус выполнения задач для методов ``Check``, ``Prepare``, ``Send``: :ref:`GET DraftTask<rst-markup-DraftTasks>`. Если запрос по методу ``Send`` завершился успешно, то в ответе вернется информация о созданном документообороте (ДО).

В рамках проактивных выплат ДО считается завершенным после отправки черновика. Когда СФР обработает данные, отправит документ с результатом обработки или приема сообщения. На него нужно отправить ответный документ "Отметка о прочтении". О том, как сформировать и отправить отметку о прочтении читайте в разделе :ref:`Отправка ответных документов<rst-markup-reply-docs>`.  

Для каждого документооборота поступит соответствующий входящий документооборот от СФР. Документы отобразятся в исходящем и входящем ДО. 

Тестирование сценариев
----------------------

Если для тестирования вы используете сертификаты Контура, то они уже готовы для работы с СЭДО. Если вы используете другие сертификаты, то сертификаты удостоверяющих центров должны быть добавлены в список доверенных сертификатов со стороны СФР. 

Для удобства тестирования сценариев работы в СЭДО СФР используйте коллекции Postman:

:download:`Коллекция Postman для работы с исходящими документооборотами</files/sedo/Работа_с_исходящими_документооборотами_postman_collection.json>`.

В примерах xml-файлов ниже укажите данные из вашей учетной записи. Обратите внимание, что данные в сертификате должны совпадать с данными вашей учетной записи. 

:download:`Сведения о застрахованных лицах, пример.xml </files/sedo/Сведения_о_застрахованных_лицах,_пример.xml>`

:download:`Ответ на запрос проверки подтверждения, корректировки сведений проактивной выплаты страхового обеспечения, пример.xml </files/sedo/Ответ_на_запрос_проверки_ пример.xml>`
