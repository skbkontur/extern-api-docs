Заявление на подключение к электронному документообороту с СФР
==============================================================

Прежде, чем отправлять в электронном виде отчетность в СФР, нужно направить заявление на подключение к электронному документообороту (ЗПЭД) с СФР.  Данное заявление должно содержать:

* единый регистрационный номер (ЕРН);
* наименование страхователя (юридического лица);
* ИНН;
* КПП страхователя (юридического лица);
* ФИО (при наличии) страхователя (физического лица);
* реквизиты оператора, через которого планируется передача сведений.

После отправки заявления на подключение к ЭДО, у работодателя появится возможность сдавать формы ЕФС-1, АДВ-1, АДВ-2, АДВ-3 через оператора связи. Но сначала нужно дождаться успешного принятия заявления на подключение к ЭДО от СФР. Для отключения от ЭДО СФР необходимо подать «Заявление на отключение от ЭДО», в API Контур.Экстерна пока нет возможности отправить его.

Если уже есть успешно принятые отчеты в бывшем ПФР, то заново отправлять заявление на подключение страхователя к ЭДОК не нужно. Отправьте ЗПЭД повторно, если у организации изменился регистрационный номер страхователя или оператор электронного документооборота (например, Контур, Тензор, Калуга-Астрал и др.).

**Особенности подписи**

Заявление должно быть подписано подписью в формате XMLDsig. Подробнее в :doc:`Подпись XMLDsig</manuals/xmldsig>`.

Порядок действий для отправки заявления на подключение к ЭДОК
-------------------------------------------------------------

Заявление на подключение  к ЭДОК можно передать через API Конутр.Экстерна, тип документооборота urn:docflow:pfr-ancillary. Статусы и порядок документооборота описаны в :ref:`спецификации<rst-markup-ancillary-status>`.

.. warning:: С 1 ноября 2024 года СФР не принимает ЗПЭД с регистрационным номером ПФР. Отчетность необходимо подавать с единым регистрационным номером (ЕРН). 
    
    В API Контур.Экстерна укажите ЕРН в поле ``registration-number-sfr``.

Если есть файл заявления на подключение к ЭДОК с прикрепленной подписью xmlDsig
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

1. Создайте черновик: :ref:`POST Create draft<rst-markup-createdraft>`.
2. Загрузите в сервис контентов подписанный файл заявления с прикрепленной подписью xmlDsig: :ref:`POST Upload<rst-markup-post-content>`.
3. Создайте документ в черновике, в теле запроса передать идентификатор контента content-id: :ref:`POST Add Document<rst-markup-addDocument>`. 
4. Проверьте, подготовьте, отправьте черновик:  :ref:`POST Check<rst-markup-check>` -> :ref:`POST Prepare<rst-markup-prepare>` ->  :ref:`POST Send<rst-markup-send>`.

СФР в течение двух рабочих дней направит «Уведомление о результате рассмотрения», успешно принятым считается уведомление с отметкой об удовлетворении заявления. Документооборот завершен.

Если нет файла заявления на подключение
+++++++++++++++++++++++++++++++++++++++

Если нет файла заявления на подключение, его можно сгенерировать при помощи методов формирования файлов в черновике. Сценарий работы с черновиком в таком случае будет следующий:

1. Создайте черновик: :ref:`POST Create draft<rst-markup-createdraft>`.
2. Создайте документ в черновике по json контракту: :ref:`POST BuildDocumentContent<rst_markup_BuildDocumentContent>`.
3. Добавьте в документ :doc:`подпись XMLDsig</manuals/xmldsig>`:

    a. По content-id скачайте сгенерированный файл заявления из сервиса контентов: :ref:`GET Download<rst-markup-get-content>`.
    b. Добавьте в файл подпись в формате xmlDsig. Если нужна помощь в создании подписи, смотрите алгоритм :doc:`формирования XMLDsig подписи на стороне API</manuals/xmldsig>`. Если воспользовались алгоритмом, перейти в п.6.
    c. Загрузите подписанный файл в Сервис контентов: :ref:`POST Upload<rst-markup-post-content>`.
    d. Заменить контент документа на полученный идентификатор Сервиса контентов: :ref:`PUT Document<rst-markup_PutDocument>`.

4. Проверьте черновик: :ref:`POST Check<rst-markup-check>`.
5. Подготовьте черновик: :ref:`POST Prepare<rst-markup-prepare>`.
6. Отправьте черновик: :ref:`POST Send<rst-markup-send>`.