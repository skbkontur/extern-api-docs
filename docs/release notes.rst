.. _`поиск документооборотов`: https://developer.kontur.ru/doc/extern.docflows/method?type=get&path=%2Fv1%2F%7BaccountId%7D%2Fdocflows
.. _`POST Recognize`: https://developer.kontur.ru/doc/extern.docflows/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdocflows%2F%7BdocflowId%7D%2Fdocuments%2F%7BdocumentId%7D%2Frecognize
.. _`Send`: https://developer.kontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdrafts%2F%7BdraftId%7D%2Fsend
.. _`сервис контентов`: https://developer.kontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fcontents
.. _`POST SignPfrReplyDocument`: https://developer.kontur.ru/doc/extern.docflows/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdocflows%2F%7BdocflowId%7D%2Fdocuments%2F%7BdocumentId%7D%2Fpfr-replies%2F%7BreplyId%7D%2Fcloud-sign
.. _`GET DocflowPfrReplyDocumentTask`: https://developer.kontur.ru/doc/extern.docflows/method?type=get&path=%2Fv1%2F%7BaccountId%7D%2Fdocflows%2F%7BdocflowId%7D%2Fdocuments%2F%7BdocumentId%7D%2Fpfr-replies%2F%7BreplyId%7D%2Ftasks%2F%7BapiTaskId%7D
.. _`POST SignConfirmPfrReplyDocument`: https://developer.kontur.ru/doc/extern.docflows/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdocflows%2F%7BdocflowId%7D%2Fdocuments%2F%7BdocumentId%7D%2Fpfr-replies%2F%7BreplyId%7D%2Fcloud-sign-confirm

История изменений API
=====================

Август 2021
-----------

* Поддержали в :doc:`методах формирования файлов</drafts/DraftDocumentBuildController>` генерацию новой версии УСН по новому контракту. В разделе Справка добавлен :doc:`файл новой версии контракта</manuals/contracts>` для формирования файла версии 5.06 для отчётности с 2021 года.
* В методах по работе с документооборотом в API добавлен новый метод :ref:`Сохранения расшифрованного контента в документ<rst-markup-savedecryptcontent>`.

Март 2021
---------

* Исправлена ошибка 500, которая появлялась при попытке печати приложений в письмах от ПФР в формате ods/excel. Теперь API возвращает ошибку 400 PrintUnsupported.
* Для поручений, которые приходят вместе с требованиями от ФНС, добавлена возможность распознавания корректного КНД из файла. Чтобы отличить поручение от требования добавлено новое поле ``demand_knd`` (модели DemandAttachmentRequisites и RecognizedMeta), в котором будет лежать КНД поручения. Чтобы поле заполнилось нужно вызвать метод :ref:`Распознавания требования<rst-markup-document-recognize>`.

Февраль 2021
------------

* Новый документооборот для отправки писем в Росстат, подробнее в статье :doc:`Отправка писем в Росстат</knowledge base/stat-letter>`.
* В метаинформации документоооборота письма в ФНС (модель LetterDescription) добавлено новое поле ``sender-inn``.
* В метаинформации документоооборота письма из ФНС (модель CuLetterDescription) добавлено новое поле ``recipient-inn``.

Декабрь 2020
------------

* В документации появилась новая :doc:`cтатья по криптографии</manuals/cryptography>`.
* Исправлена ошибка при отправке Заявления на подключение к ЭДОК.
* В методе распознавания требования добавлена проверка, что файл требования в формате pdf.
* В метаинформации документооборота требования (модель DemandDescription) добавлено новое поле ``sent-on-report-filename`` — имя файла отчета, на которое сформировано требование.
* В метаинформации документооборота 4-ФСС (модель FssReportDescription) добавлено новое поле ``correction-number`` — номер корректировки.

**Обновления в Extern Test Tools:**

* Поддержан новый способ :doc:`аутентификации по протоколу OpenId Connect </auth_oidc/index>`. Рекомендуется выполнять запросы при помощи Postman. Старый способ аутентификации через auth.sid будет поддерживаться для реализованных интеграций. 


Ноябрь 2020
-----------

* Для устаревших методов по получению зашифрованного и расшифрованного контента введены ограничения на размер запрашиваемого контента: 32 МБ на тестовой и 64 МБ на рабочей площадке. Для получения больших контентов вместо старых методов рекомендуется использовать Сервис контентов.
* В свойствах документа документа в документообороте реализован новый вспомогательный параметр SupportPrint (модель DocflowDocumentDescription), который поможет определить возможность печати документа. Параметр может иметь одно из трех значений: Yes, No, Unknown. Подробнее в статье :doc:`Печать </knowledge base/print>`.

Октябрь 2020
-------------

Новый способ :doc:`аутентификации по протоколу OpenId Connect </auth_oidc/index>`. Старый способ аутентификации через auth.sid будет поддерживаться для реализованных интеграций. 

Сентябрь 2020
-------------

* Новый вид :ref:`документооборота с ЦБ РФ<rst-markup-cbrf>`. Доступен только для получения списка документооборотов. Отправить документы в ЦБ РФ можно в веб-интерфейсе Экстерна.
* API теперь поддерживает новые формы заявления регистрации бизнеса. Полный список кодов заявлений описан в методе :ref:`Создания DraftsBuilder<rst-markup-createDB>` (параметр application-code).

**Обновления в Extern Test Tools:**

* Исправлена ошибка экранирования кавычек, из-за которой в некоторых случаях могло некорректно сформироваться входящее требование.


Август 2020
-----------

* В методах API добавлен **новый метод проверки требований**. Метод помогает определить корректность поступившего требования. Если требование не прошло проверки, будут сформированы коды ошибок, которые нужно использовать при формировании уведомления об отказе. Подробнее в инструкции :doc:`Проверка требований</knowledge base/check-demand>`. 
* Настроено корректное отображение размера расшифрованного контента документа в поле decrypted-content-size.
* Исправлена ошибка печати документов из документооборота ПОВЭД: в печатной форме отчета корректно проставляется дата отчета и наименование организации. 

Июнь 2020
---------

* В методах API добавлена возможность формирования подписи xmlDsig для подписания :doc:`отчета СЗВ-ТД и заявления на подключение к ЭДОК в ПФР</knowledge base/szvtd>`. Подробное описание в документации: :doc:`Подпись XMLDsig для отчетов в ПФР</manuals/xmldsig>`.

Май 2020
--------

* Добавили в :doc:`методы формирования файлов</drafts/DraftDocumentBuildController>` в черновике возможность генерации заявления на подключение к ЭДОК. Достаточно передать валидный JSON контракт, метод сгенерирует контент файла и положит его в документ черновика.
* О штампах в печатных формах:

    * Внесли правки в печати штампов на отчетах. 
    * Добавили в штампы помимо названия инспекции ее код.
    * Добавили штампы в печатные формы отчета 2-НДФЛ.

* В печатных формах добавили указание общего количества страниц.
* В документации добавили новый раздел :doc:`Начало работы с API</howto/index>`.

Апрель 2020
-----------

* Доработали `поиск документооборотов`_: теперь можно запрашивать сразу несколько типов в параметре type. Например, type=fns534-report&type=pfr-report.
* Новый вид отчетности в ПФР: отправка отчета СЗВ-ТД и готового заявления на подключение к ЭДОК.
* Добавили в description документооборота ИНН-КПП реорганизованных и ликвидированных организаций, которые лежат внутри отчетов по таким организациям.
* В рамках :doc:`документооборота регистрации бизнеса</knowledge base/businessReg>`реализовали регистрацию ЮЛ, отправку документов на ликвидацию ИП.

Март 2020
---------

* Добавили возможность асинхронной печати документов, теперь можно ставить задачи на печать (Tasks).
* Исправили появление дублей в документообороте Росстата.
* Добавили ссылки в документообороте 4-ФСС, которые ведут в веб-интерфейс Экстерна.
* Добавили проверку сертификата подписи при отправке ответных документов ФНС: ИНН в сертификате подписи должен быть равен ИНН в поле Sender. 

Февраль 2020
------------

* Изменили `поиск документооборотов`_:

    * теперь в общий список не будут попадать документообороты регистрации бизнеса. Чтобы получить документообороты по данному типу нужно передать параметр ``type = business-registration``;
    * добавили новый тип документооборота с ФСС — Подтверждение основного вида экономической деятельности (ПОВЭД). Данный тип документооборота можно только получить. Отправить электронную форму ПОВЭД можно только в Экстерне. 

* Научились распознавать срок ответа на требование из PDF файла требования ФНС. Метод распознавания требования `POST Recognize`_.
* Исправили текст сообщений об ошибках отправки черновика (`Send`_) для случаев, когда указан неверный тип контента или некорректный ip-адрес.
* Исправили ошибку генерации ответного документа (reply document), у которого нет печатной формы.
* В документации добавили статью по работе с методами :ref:`ленты событий <rst-markup-events>`, также описаны :doc:`/specification/статусы ленты событий`.
* Добавили новые методы по работе с контентом, см. раздел в swagger `сервис контентов`_:
    
    * Реализована работа с большими файлами документов документооборотов: методы позволяют скачивать контент любого размера. 
    * В модели документооборотов, созданных от 02.02.2020, добавлены идентификаторы контентов документов.
    * В методах по работе с контентами файлов можно передавать только идентификатор контента, например, для печати документа.

Январь 2020
-----------

**Обновления в API Контур.Экстерна:**

* Добавили уведомления в ленту событий по документооборотам ФСС и ПФР.
* Добавили контентам документов описание состояния: сжат, зашифрован, расшифрован и т.д. Ранее описание состояния было только у документа и могло быть некорректным.
* Исправили ошибку при создании черновика: для ИП не обязательно заполнение Payer.Organization.

**Обновления в Extern Test Tools:**

* В методах генерации требований и писем добавили поле ifnsCode, что позволит тестировать получение требований от разных ИФНС. 

______

Ранее мы не вели практику написания изменений в API, поэтому обновлений за 2018-2019 год нет. 