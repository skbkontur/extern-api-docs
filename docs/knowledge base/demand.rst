.. _`Extern Test Tools`: https://developer.kontur.ru/doc/extern.test.tools
.. _`POST UploadContent`: https://extern-api.testkontur.ru/test-tools/swagger/index.html
.. _`POST GenerateDemand`: https://developer.kontur.ru/doc/extern.test.tools/method?type=post&path=%2Ftest-tools%2Fv1%2Fgenerate-demand
.. _`POST Upload`: https://developer.kontur.ru/doc/extern.contents/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fcontents
.. _`Swagger`: https://extern-api.testkontur.ru/test-tools/swagger/index.html
.. _`Контур.Документации API`: https://developer.kontur.ru/doc/extern.test.tools/method?type=post&path=%2Ftest-tools%2Fv1%2Fupload-content

Требование
==========

Требование – документ, который налоговый орган направляет налогоплательщику (НП). Получение требования и ответ на него — пример работы с входящим документооборотом. В зависимости от вида требования налогоплательщику нужно совершить определенные действия: отправить первичные документы, уплатить штраф или явиться в налоговую.

Входящий документооборот (ДО) с типом ``fns534-demand`` содержит много документов, требование приходит в виде приложения, т.е. документ с типом ``fns534-demand-attachment``. 

Процесс работы с требованиями
-----------------------------

Работа с требованиями состоит из трех этапов:

1. Получение списка требований.
2. Работа с входящим документооборотом.
3. Ответ на требование (документ описи).

.. image:: /_static/demand.png

В разделе :ref:`статусы и порядок документооборота<rst-markup-demand-status>` показан процесс работы с требованием. 

Получение списка требований
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Посмотреть полученные требования можно методом :ref:`получения списка документооборотов<rst-markup-get-dcs>` с помощью фильтров:

* по типу документооборота: ``type = fns534-demand``;
* по номеру требования: ``demandNumber``. По номеру можно найти только :ref:`распознанные требования<rst-markup-document-recognize>`. 

Работа с входящим документооборотом
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

При получении требования нужно сформировать в ответ налоговому органу квитанцию о приеме (КоП) или уведомление об отказе (УО). Отправить их необходимо в течение 6 рабочих дней с момента получения требования. Для требования об уплате налога срок ответа – 1 рабочий день.

Уведомление об отказе формируется в следующих случаях:

* ошибочное направление налогоплательщику;
* несоответствие утвержденному формату;
* отсутствие КЭП налогового органа.

Во всех остальных случаях формируется квитанция о приеме. 

Чтобы убедиться, какой именно документ нужно сформировать в ответ (КоП или УО), нужно :doc:`проверить требование</knowledge base/check-demand>`. Если по окончании работы метода :ref:`POST Check-Demand<rst-markup-check-demand>` были выявлены ошибки, то можно переходить к формированию УО. Ссылка на генерацию документа и коды ошибок будут перечислены в ответе метода. Если ошибки при проверке требования не найдены, можно формировать КоП. 

Для генерации и отправки КоП или УО нужно воспользоваться :doc:`методами для работы с ответными документами </dc/ответный документ>`. 

На этом работа с входящим документооборотом требования завершается.

Ответ на требование (документооборот описи)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. note:: Только для требований с КНД 1165050 и 1165013. 

После отправки квитанции о приеме начинается отсчет срока для предоставления ответа на требование. Ответ на требование — это начало нового документооборота :doc:`описи</knowledge base/inventory>`. Но формируем его не ко всему входящему документообороту, а только к файлу требования в нем (документу с типом fns534-demand-attachment). Сроки ответа и основания для требований разные и всегда указаны в самом требовании. 

В электронном виде можно ответить на требования о представлении пояснений и документов (информации). По договоренности налогоплательщика с налоговым органом ответ можно отправить письмом, а не описью. Остальные требования и документы требуют от налогоплательщика других действий, например, уплатить налог, либо явиться в ИФНС.

Требование о представлении пояснений КНД 1165050
    *Требование КНД 11650505 подразумевает предоставление пояснений. Иногда с требованием приходит XML-файл, в котором налогоплательщик обязан вписать свои пояснения и выслать его в ответ. На требование о представлении пояснений можно отправить опись документов*.

Требование о представлении документов (информации) КНД 1165013
    *На требование о представлении документов (информации) нужно отправить опись со списком запрашиваемых документов*.

Тестовые данные
---------------

Тестовые входящие требования можно сгенерировать с помощью сервиса `Extern Test Tools`_ двумя способами.

**Первый способ**

Можно сгенерировать входящее требование с помощью тестового робота: `POST GenerateDemand`_. При вызове метода заполните КНД требования – параметр ``Knds``.

**Второй способ**

Можно загрузить уже имеющиеся файлы требования. Сервис Extern Test Tools распознает строки требования и вернет с помощью тестового робота. Для этого:

1. Загрузите файлы требования в Сервис контентов: `POST UploadContent`_. Метод вернет идентификатор контента загруженного файла. В Сервис контентов можно загрузить один документ в формате pdf за раз. 

.. note::  В `Контур.Документации API`_ пока нет возможности загружать файлы, поэтому рекомендуем воспользоваться методом в `Swagger`_.

2. Сгенерируйте входящее требование с помощью тестового робота: `POST GenerateDemand`_. При вызове метода укажите идентификатор контента и КНД требования в модели ``Contents``.

.. warning:: Загрузить файл требования в Сервис контентов для генерации входящего документооборота можно только с помощью метода `POST UploadContent`_. Метод `POST Upload`_ не предназначен для работы с тестовыми данными.  
