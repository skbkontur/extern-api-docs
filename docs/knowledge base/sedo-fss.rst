.. _`Постановление Правительства РФ от 21.04.2011 № 294`: https://normativ.kontur.ru/document?moduleId=1&documentId=326338&rangeId=389064
.. _`часть 4 ст.15.33 КоАП`: https://normativ.kontur.ru/document?moduleId=1&documentId=367767&rangeId=389122

Уведомления и извещения СЭДО ФСС
================================

ФСС разработал универсальный сервис электронного документооборота — СЭДО. Через СЭДО ФСС может обмениваться сообщениями и документами (входящими и исходящими) со страхователями при посредничестве операторов ЭДО. 

На текущий момент через данный сервис возможно работать со следующими документооборотами:

* извещения ПВСО (тип документооборота urn:docflow:fss-sedo-pvso-notification),
* уведомление об изменении статуса ЭЛН (тип документооборота urn:docflow:fss-sedo-sick-report-change-notification).

Для получения извещений ПВСО и уведомление об изменении статуса ЭЛН, сперва необходимо совершить :doc:`подписки на получение извещений и уведомлений</knowledge base/sedo-subscription>`. Подписки также являются отдельными документооборотами. 

.. rubric:: Особенности документооборотов с СЭДО

* Входящие документообороты от ФСС, отправленные через СЭДО, в статусе received не содержат документов. Чтобы их получить нужно сформировать запрос на получение документов. 
* Все отправляемые в СЭДО документы являются SOAP-запросами.
* Запросы должны быть подписаны подписью в формате XMLDsig.

Извещения ПВСО
--------------

Если страхователь не в полном объеме представляет документы или сведения для назначения пособия, территориальное отделение ФСС в течение 5 рабочих дней со дня их получения направляет страхователю извещение о представлении недостающих документов или сведений (`Постановление Правительства РФ от 21.04.2011 № 294`_).

Извещение направляется в электронном виде. При получении извещения страхователь должен отправить подтверждение в электронном виде о его получении в течение 5 рабочих дней со дня получения.

В случае отсутствия подтверждения получения извещения территориальный орган Фонда направляет страхователю такое извещение заказным письмом. В этом случае через 6 рабочих дней после отправки по почте, считается, что извещение получено.

У страхователя есть 5 рабочих дней с даты подтверждения, чтобы отправить реестр с дополненными сведениями. Если направить реестр позже отведенного срока, то возможен административный штраф в размере 300-500 руб. (`часть 4 ст.15.33 КоАП`_).

Уведомления об электронных больничных
-------------------------------------

Данные уведомления позволяют не ждать, пока сотрудник предоставит номер больничного листа работодателю. Если работодатель подписан на уведомления ЭЛН по сотруднику, то он сможет получать от ФСС:

* уведомления о новых электронных больничных,
* уведомления об изменении из статуса электронных больничных.

Получение извещений, уведомлений и ошибок
-----------------------------------------

.. note:: Для получения извещений и уведомлений страхователю необходимо осуществить подписку.

После успешных подписок, ФСС начинает присылать извещения ПВСО и уведомления об ЭЛН. Если в ходе документооборотов происходит ошибка, она может прийти в отдельном документообороте Сообщения об ошибках (тип документооборота urn:docflow:fss-sedo-error).

.. warning:: Изначально, документообороты в статусе **received** не содержат документ с извещением, уведомлением или ошибкой. При поступлении нового входящего документооборота пользователю необходимо сформировать запрос на получение документов, подписать его своим сертификатом и отправить в ФСС. После получения подписанного запроса ФСС направит документ с извещением или уведомлением. 

Схемы смены статусов документооборотов см. в разделе :ref:`спецификация<rst-markup_pvso>`.

**Порядок действий для получения документов от ФСС**

1. Найти входящие документообороты от ФСС методом :ref:`GET Docflows<rst-markup-get-dcs>` с фильтром ``type=fss-sedo-pvso-notification&type=fss-sedo-sick-report-change-notification&type=fss-sedo-error``. Новые документообороты будут отображаться в статусе **received**. Далее работаем с каждым документооборотом по отдельности. 

2. Для выбранного документооборота нужно сформировать, подписать и отправить запрос на получение документов от ФСС. Для этого нужно использовать :ref:`методы генерации запроса в СЭДО ФСС<rst-markup-sedo>`:

    1. Создать запрос на получение документов от ФСС. Метод :ref:`POST GenerateDocumentsRequest<rst-markup-sedo>`. В ответе метод возвращает шаблон запроса и хэш для подписи.
    2. Подписать хэш, который вернется в параметре DataToSign в формате byte[].
    3. Добавить необработанную подпись к запросу. Метод :ref:`PUT SaveDocumentsRequestSignature<rst-markup-sedo>`.
    4. Отправить запрос на получение документов в ФСС. Метод :ref:`POST SendDocumentsRequest<rst-markup-sedo>`. При отправке запроса подпись будет встроена в шаблон. 

3. Когда ФСС обработает запрос, он отправит запрошенный документ. Документ появится в текущем документообороте. Статус документооборота поменяется на response-arrived. Рекомендуем для дальнейшей работы каждый документооборот вычитать отдельно методом :ref:`GET Docflow<rst-markup-get-dc>`.

    Если в ходе документооборота с СЭДО ФСС появится ошибка, то она может поступить: 

    * в виде документа в исходном документообороте. В этом случае статус документооборота поменяется на **finished**. Типы документов об ошибке:

        * urn:document:fss-sedo-pvso-notification-exchange-error — для извещений ПВСО;
        * urn:document:fss-sedo-sick-report-change-notification-exchange-error — для уведомлений по изменению ЭЛН.

    * в виде отдельного документооборота urn:docflow:fss-sedo-error. В этом случае переходим в п.2. с поступившим документооборотом с сообщением об ошибке. Документ с ошибкой от ФСС отобразится в первоначальном документообороте. Статус документооборота поменяется на **finished**. Типы документов об ошибке:

        * urn:document:fss-sedo-pvso-notification-error-message — для извещений ПВСО;
        * urn:document:fss-sedo-sick-report-change-notification-error-message — для уведомлений по изменению ЭЛН.

4. Найти в метаинформации документооборота документ с типом:

    * urn:document:fss-sedo-pvso-notification-notification-message — для извещений ПВСО;
    * urn:document:fss-sedo-sick-report-change-notification-notification-message — для уведомлений по изменению ЭЛН.
    
    Если нужно получить файл документа, то по идентификатору content-id скачать документ из :doc:`Сервиса контентов</contents/content_methods>`. Идентификатор content-id лежит в метаинформации документа, в модели docflow-document-contents.

5. Сгенерировать ответный документ "Извещение о прочтении" к полученному документу. Для этого нужно взять id найденного документа и подставить его в метод :ref:`POST CreateReplyDocument<rst-markup-post-reply-doc>`. В поле documentType указать тип документа:

    * fss-sedo-pvso-notification-receipt — для извещений ПВСО;
    * fss-sedo-sick-report-change-notification-receipt — для уведомлений по изменению ЭЛН.
    
    Подписывать "Извещение о прочтении" не нужно.

6. Отправить ответный документ методом :ref:`POST SendReplyDocument<rst-markup-post-reply-doc>`. После отправки извещения о прочтении статус документооборота поменяется на **finished**.