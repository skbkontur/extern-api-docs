Сервис контентов
================

Сервис контентов предназначен для загрузки и скачивания файлов.

Что нужно знать о сервисе контентов
-----------------------------------

С помощью методов сервиса контентов можно:

* загрузить контент целиком или по частям,
* скачать контент целиком или по частям.

Для загрузки документов размером больше 64 Мбайт следует применять загрузку по частям.

В методах загрузки и получения контента черновиков, документооборотов в соответствующих моделях появился параметр content-id, который содержит идентификатор контента. 
Для поддержания обратной совместимости сохранены старые способы загрузки и скачивания контентов напрямую в методах. 

Все документы, которые появляются в документообороте, будут иметь в модели идентификатор контента content-id. Это означает, что все документы от контролирующего органа также будут доступны для скачивания в сервисе контентов. 

Преимущества сервиса контентов
------------------------------

Сервис контентов позволяет загружать большие файлы отчетов. Сервис может работать с контентами до 30 ГБ. 

Если один и тот же файл необходимо передать в нескольких методах, вам не нужно его загружать повторно, например, для печати. Достаточно передать идентификатор контента. 

Как это работает
----------------

Загружаем файл в сервис контентов
+++++++++++++++++++++++++++++++++

1. Если документ больше 64 МБ, разбиваем на части по 64 МБ.
2. Вызываем метод :ref:`POST Upload<rst-markup-post-content>`. Для загрузки контента по частям нужно передать заголовок Content-Range.
3. Догружаем части контента методом :ref:`PUT UploadByParts<rst-markup-put-content>`.

    Части контента не обязательно грузить в порядке очередности. Но в итоге все части контента должны быть переданы. 

4. Передаем идентификатор контента в нужном методе, например, добавление документа в черновик.

**Пример запроса загрузки контента**

**Запрос**

.. code-block:: http

    POST /v1/bd0cd3f6-315d-4f03-a9cc-3507f63265ed/contents HTTP/1.1
    Authorization: Bearer <token>
    Content-Type: application/octet-stream

    Контент передан в теле запроса 

**Ответ**

.. code-block:: http

    HTTP/1.1 201 Created
    Content-Type: application/json; charset=utf-8
    Content-Length: 52
    
    {
    "id": "d065adea-8b9d-4228-bc17-8f86539e01a3"
    }

Скачиваем файл из сервиса контентов
+++++++++++++++++++++++++++++++++++

1. Получаем документ в черновике или документообороте. 
2. Берем значение параметра content-id.
3. Инициируем получение контента по идентификатору методом :ref:`GET Download<rst-markup-get-content>`.

**Пример запроса получения контента**

**Запрос**

.. code-block:: http

    GET /v1/bd0cd3f6-315d-4f03-a9cc-3507f63265ed/contents/d065adea-8b9d-4228-bc17-8f86539e01a3 HTTP/1.1
    Authorization: Bearer <token>
    Content-Type: application/octet-stream

**Ответ**

.. code-block:: http

    HTTP/1.1 200 OK
    Content-Type: application/octet-stream
    Content-Length: 727

    <?xml version="1.0" encoding="windows-1251"?>
        <Файл/>
            ...
        </Файл>